<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="evalITR">
<title>Sample Splitting • evalITR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample Splitting">
<meta property="og:description" content="evalITR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">evalITR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-s-guide">User's Guide</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-s-guide">
    <a class="dropdown-item" href="../articles/install.html">Installation</a>
    <a class="dropdown-item" href="../articles/sample_split.html">Sample Splitting</a>
    <a class="dropdown-item" href="../articles/sample_split_caret.html">Sample Splitting with Caret</a>
    <a class="dropdown-item" href="../articles/cv_single_alg.html">Cross-Validation</a>
    <a class="dropdown-item" href="../articles/cv_multiple_alg.html">Cross-Validation with Multiple Algorithms</a>
    <a class="dropdown-item" href="../articles/user_itr.html">User-Defined ITR</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MichaelLLi/evalITR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sample Splitting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MichaelLLi/evalITR/blob/HEAD/vignettes/sample_split.Rmd" class="external-link"><code>vignettes/sample_split.Rmd</code></a></small>
      <div class="d-none name"><code>sample_split.Rmd</code></div>
    </div>

    
    
<p>This is an example using the <code>star</code> dataset (for more
information about the dataset, please use <code><a href="../reference/star.html">?star</a></code>).</p>
<p>We start with a simple example with one outcome variable (writing
scores) and one machine learning algorithm (causal forest). Then we move
to incoporate multiple outcomes and compare model performances with
several machine learning algorithms.</p>
<p>To begin, we load the dataset and specify the outcome variable and
covariates to be used in the model. Next, we utilize a random forest
algorithm to develop an Individualized Treatment Rule (ITR) for
estimating the varied impacts of small class sizes on students’ writing
scores. Since the treatment is often costly for most policy programs, we
consider a case with 20% budget constraint (<code>budget</code> = 0.2).
The model will identify the top 20% of units who benefit from the
treatment most and assign them to with the treatment. We train the model
through sample splitting, with the <code>split_ratio</code> between the
train and test sets determined by the <code>split_ratio</code> argument.
Specifically, we allocate 70% of the data to train the model, while the
remaining 30% is used as testing data (<code>split_ratio</code> =
0.7).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MichaelLLi/evalITR" class="external-link">evalITR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/star.rda"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specifying the outcome</span></span>
<span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="st">"g3tlangss"</span></span>
<span></span>
<span><span class="co"># specifying the treatment</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="st">"treatment"</span></span>
<span></span>
<span><span class="co"># specifying the data (remove other outcomes)</span></span>
<span><span class="va">star_data</span> <span class="op">&lt;-</span> <span class="va">star</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">g3treadss</span>,<span class="va">g3tmathss</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specifying the formula</span></span>
<span><span class="va">user_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span></span>
<span>  <span class="st">"g3tlangss ~ treatment + gender + race + birthmonth + </span></span>
<span><span class="st">  birthyear + SCHLURBN + GRDRANGE + GKENRMNT + GKFRLNCH + </span></span>
<span><span class="st">  GKBUSED + GKWHITE "</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># estimate ITR </span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>  form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>  algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"causal_forest"</span><span class="op">)</span>,</span>
<span>  budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  split_ratio <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluate ITR under sample splitting ...</span></span>
<span></span>
<span></span>
<span><span class="co"># evaluate ITR </span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cannot compute PAPDp</span></span></code></pre></div>
<p>The<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function displays the following summary
statistics: (1) population average prescriptive effect
<code>PAPE</code>; (2) population average prescriptive effect with a
budget constraint <code>PAPEp</code>; (3) population average
prescriptive effect difference with a budget constraint
<code>PAPDp</code>. This quantity will be computed with more than 2
machine learning algorithms); (4) and area under the prescriptive effect
curve <code>AUPEC</code>. For more information about these evaluation
metrics, please refer to <a href="https://arxiv.org/abs/1905.05389" class="external-link">Imai
and Li (2021)</a>; (5) Grouped Average Treatment Effects
<code>GATEs</code>. The details of the methods for this design are given
in <a href="https://arxiv.org/abs/2203.14511" class="external-link">Imai and Li
(2022)</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarize estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── PAPE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     0.35           1.3 causal_forest      0.26    0.79</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPEp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.8           1.3 causal_forest       1.4    0.16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPDp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; data frame with 0 columns and 0 rows</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── AUPEC ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     0.83           1.1 causal_forest      0.79    0.43</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── GATE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm group statistic p.value  upper lower</span></span>
<span><span class="co">#&gt; 1      177           110 causal_forest     1      1.61    0.11   -3.6   357</span></span>
<span><span class="co">#&gt; 2     -143           107 causal_forest     2     -1.34    0.18 -319.0    33</span></span>
<span><span class="co">#&gt; 3      -64           107 causal_forest     3     -0.60    0.55 -240.3   112</span></span>
<span><span class="co">#&gt; 4       72           109 causal_forest     4      0.66    0.51 -107.9   252</span></span>
<span><span class="co">#&gt; 5      -32           107 causal_forest     5     -0.30    0.76 -208.1   144</span></span></code></pre></div>
<p>We can extract estimates from the <code>est</code> object. The
following code shows how to extract the GATE estimates for the writing
score with the causal forest algorithm.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot GATE estimates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span><span class="op">$</span><span class="va">GATE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>    ymin <span class="op">=</span> <span class="va">lower</span> , ymax <span class="op">=</span> <span class="va">upper</span>, color <span class="op">=</span> <span class="va">algorithm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/geom_pointinterval.html" class="external-link">geom_pointinterval</a></span><span class="op">(</span></span>
<span>    width <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    interval_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>    fatten_point <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"GATE estimate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#4e4e4e"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#0072B2"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#076f00"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/README-est_extract-1.png" width="576"></p>
<p>We plot the estimated Area Under the Prescriptive Effect Curve for
the writing score across a range of budget constraints for causal
forest.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the AUPEC </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/README-sp_plot-1.png" width="576"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Lingzhi Li, Kosuke Imai.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
