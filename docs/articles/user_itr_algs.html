<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="evalITR">
<title>Compare Estimated and User Defined ITR • evalITR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compare Estimated and User Defined ITR">
<meta property="og:description" content="evalITR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">evalITR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-s-guide">User's Guide</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-s-guide">
    <a class="dropdown-item" href="../articles/install.html">Installation</a>
    <a class="dropdown-item" href="../articles/sample_split.html">Sample Splitting</a>
    <a class="dropdown-item" href="../articles/sample_split_caret.html">Sample Splitting with Caret/SuperLearner</a>
    <a class="dropdown-item" href="../articles/cv_single_alg.html">Cross-Validation</a>
    <a class="dropdown-item" href="../articles/cv_multiple_alg.html">Cross-Validation with Multiple Algorithms</a>
    <a class="dropdown-item" href="../articles/user_itr.html">User-Defined ITR</a>
    <a class="dropdown-item" href="../articles/user_itr_algs.html">Compare Estimated and User Defined ITR</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MichaelLLi/evalITR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Compare Estimated and User Defined ITR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MichaelLLi/evalITR/blob/HEAD/vignettes/user_itr_algs.Rmd" class="external-link"><code>vignettes/user_itr_algs.Rmd</code></a></small>
      <div class="d-none name"><code>user_itr_algs.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="estimated-vs--user-defined-itr">Estimated vs. User Defined ITR<a class="anchor" aria-label="anchor" href="#estimated-vs--user-defined-itr"></a>
</h3>
<p>The package allows to compare the performance of estimated ITRs with
user defined ITRs. The <code>estimate_itr</code> function takes the
following arguments:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>fit</code></td>
<td align="left">a fitted object from the <code>estimate_itr</code>
function</td>
</tr>
<tr class="even">
<td align="left"><code>user_itr</code></td>
<td align="left">a function defined by users that returns a unit-level
continuous score for treatment assignment (we assume those that have
score less than 0 should not have treatment)</td>
</tr>
<tr class="odd">
<td align="left"><code>data</code></td>
<td align="left">a data frame</td>
</tr>
<tr class="even">
<td align="left"><code>treatment</code></td>
<td align="left">a character string specifying the treatment variable in
the <code>data</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>outcome</code></td>
<td align="left">a character string specifying the outcome variable in
the <code>data</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>budget</code></td>
<td align="left">a numeric value specifying the maximum percentage of
population that can be treated under the budget constraint</td>
</tr>
</tbody>
</table>
<p>The function returns an object that contains the estimated GATE, ATE,
and AUPEC for the user defined ITR.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># estimate ITR </span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="st">"T"</span>,</span>
<span>  form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>  algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"causal_forest"</span><span class="op">)</span>,</span>
<span>  budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  split_ratio <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluate ITR under sample splitting ...</span></span>
<span></span>
<span><span class="co"># user's own ITR</span></span>
<span><span class="va">score_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>score <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">school_urban</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">0.1</span>, <span class="co"># inner-city</span></span>
<span>      <span class="va">school_urban</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0.2</span>, <span class="co"># suburban</span></span>
<span>      <span class="va">school_urban</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="fl">0.4</span>, <span class="co"># rural</span></span>
<span>      <span class="va">school_urban</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="fl">0.3</span>, <span class="co"># urban</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">score</span></span>
<span>    </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># evalutate ITR</span></span>
<span><span class="va">compare_itr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="va">fit</span>,</span>
<span>  user_itr <span class="op">=</span> <span class="va">score_function</span>,</span>
<span>  data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>  treatment <span class="op">=</span> <span class="st">"T"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcomes</span>,</span>
<span>  budget <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cannot compute PAPDp</span></span>
<span></span>
<span><span class="co"># summarize estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">compare_itr</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- PAPE ------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.5          0.99 causal_forest       1.5    0.13</span></span>
<span><span class="co">#&gt; 2      0.0          0.00      user_itr       NaN     NaN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- PAPEp -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     0.83          1.20 causal_forest      0.69    0.49</span></span>
<span><span class="co">#&gt; 2     1.06          0.67      user_itr      1.58    0.11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- PAPDp -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Cannot compute PAPDp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- AUPEC -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     2.13          0.89 causal_forest       2.4   0.017</span></span>
<span><span class="co">#&gt; 2    -0.91          0.42          &lt;NA&gt;      -2.2   0.028</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- GATE ------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;    estimate std.deviation     algorithm group statistic p.value  upper lower</span></span>
<span><span class="co">#&gt; 1       -47           108 causal_forest     1     -0.43   0.665 -224.8   131</span></span>
<span><span class="co">#&gt; 2      -216           107 causal_forest     2     -2.02   0.044 -392.1   -40</span></span>
<span><span class="co">#&gt; 3       -32           108 causal_forest     3     -0.30   0.765 -210.5   146</span></span>
<span><span class="co">#&gt; 4        74           108 causal_forest     4      0.68   0.494 -104.0   252</span></span>
<span><span class="co">#&gt; 5       228           108 causal_forest     5      2.12   0.034   51.4   405</span></span>
<span><span class="co">#&gt; 6       126            58      user_itr     1      2.16   0.031   30.2   222</span></span>
<span><span class="co">#&gt; 7        96            59      user_itr     2      1.62   0.105   -1.4   194</span></span>
<span><span class="co">#&gt; 8       -33            59      user_itr     3     -0.56   0.579 -129.7    64</span></span>
<span><span class="co">#&gt; 9      -139            59      user_itr     4     -2.36   0.018 -236.5   -42</span></span>
<span><span class="co">#&gt; 10      -32            59      user_itr     5     -0.54   0.589 -129.4    65</span></span></code></pre></div>
<p>We plot the estimated Area Under the Prescriptive Effect Curve
(AUPEC) for the writing score across a range of budget constraints for
user defined ITR and estimated ITRs. The plot shows that the estimated
ITRs have better performance than the user defined ITR.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the AUPEC </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare_itr</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/README-compare_itr_aupec-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="existing-model-vs--user-defined-model">Existing Model vs. User-Defined Model<a class="anchor" aria-label="anchor" href="#existing-model-vs--user-defined-model"></a>
</h3>
<p>The package also allows to compare the performance of estimated ITRs
of existing ML packages with user defined models. The following code
shows an example using causal forest from the <code>grf</code> package
with sample splitting. The <code>estimate_itr</code> function takes the
following arguments:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>treatment</code></td>
<td align="left">a character string specifying the treatment variable in
the <code>data</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>form</code></td>
<td align="left">a formula specifying the outcome and covariates</td>
</tr>
<tr class="odd">
<td align="left"><code>data</code></td>
<td align="left">a data frame</td>
</tr>
<tr class="even">
<td align="left"><code>algorithms</code></td>
<td align="left">a character vector specifying the ML algorithms to be
used</td>
</tr>
<tr class="odd">
<td align="left"><code>budget</code></td>
<td align="left">a numeric value specifying the maximum percentage of
population that can be treated under the budget constraint</td>
</tr>
<tr class="even">
<td align="left"><code>split_ratio</code></td>
<td align="left">a character string specifying the outcome variable in
the <code>data</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>user_model</code></td>
<td align="left">a character string specifying the user defined
model</td>
</tr>
</tbody>
</table>
<p>The <code>user_model</code> input should be a function that takes two
arguments: <code>training_data</code> and <code>test_data</code>. The
function will make use of the <code>training_data</code> to fit a model
and then use the <code>test_data</code> to estimate CATE or other
metrics of interest. It should also specify the way to get the ITR,
based on the estimated effects.</p>
<p>In the following example, we fit a linear model with sample splitting
and use the estimated CATE. We compute the ITR by assigning treatment to
those with positive CATE and no treatment to those with negative CATE.
The function <code>user_model</code> takes in the training data and test
data and return a list that contains (1) an ITR; (2) a fitted model; and
(3) a continuous score with the same length as the input data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user-defined model</span></span>
<span><span class="va">user_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">training_data</span>, <span class="va">test_data</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># model fit on training data</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">train_model</span><span class="op">(</span><span class="va">training_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># estimate CATE on test data</span></span>
<span>  <span class="va">compute_hatf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">test_data</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">score</span> <span class="op">&lt;-</span> <span class="fu">fit_predict</span><span class="op">(</span><span class="va">fit</span>, <span class="va">test_data</span><span class="op">)</span>  </span>
<span>    <span class="va">itr</span>   <span class="op">&lt;-</span> <span class="fu">score_function</span><span class="op">(</span><span class="va">score</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>itr <span class="op">=</span> <span class="va">itr</span>, score <span class="op">=</span> <span class="va">score</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">hatf</span> <span class="op">&lt;-</span> <span class="fu">compute_hatf</span><span class="op">(</span><span class="va">fit</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    itr <span class="op">=</span> <span class="va">hatf</span><span class="op">$</span><span class="va">itr</span>, </span>
<span>    fit <span class="op">=</span> <span class="va">fit</span>, </span>
<span>    score <span class="op">=</span> <span class="va">hatf</span><span class="op">$</span><span class="va">score</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that the user defined model can be any model that returns a
unit-level continuous score for treatment assignment. It does not have
to be a linear model or model that estimate CATE. We can specify custom
functions in the <code>train_model</code> function and the
<code>fit_predict</code> function to compute the score. If the model
does not have a default <code>predict</code> function, we need to write
up a custom function with <code>fit_predict</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># train model</span></span>
<span><span class="va">train_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>    <span class="va">Y</span> <span class="op">~</span> <span class="cn">T</span><span class="op">*</span><span class="op">(</span><span class="va">cov1</span> <span class="op">+</span> <span class="va">cov1</span> <span class="op">+</span> <span class="va">cov3</span><span class="op">)</span>, </span>
<span>    data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># predict function</span></span>
<span><span class="va">fit_predict</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># need to change this function if </span></span>
<span>  <span class="co"># the model does not have a default predict function</span></span>
<span>  <span class="va">score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">data</span><span class="op">)</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In addition, we can also choose any scoring rule that maps the score
to a binary indicator of treatment assignment.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># score function</span></span>
<span><span class="va">score_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">itr</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">score</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">itr</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If <code>split_ratio</code> is specified, the function will split the
data into training and test data. The <code>split_ratio</code> should be
a numeric value between 0 and 1. Alternatively, if <code>n_folds</code>
is specified, the function will use the entire data to fit the user
defined model via cross-validation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate ITR</span></span>
<span><span class="va">compare_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="st">"T"</span>,</span>
<span>  form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>  algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"causal_forest"</span><span class="op">)</span>,</span>
<span>  budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  split_ratio <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  user_model <span class="op">=</span> <span class="st">"user_model"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluate ITR under sample splitting ...</span></span>
<span></span>
<span></span>
<span><span class="co"># evaluate ITR </span></span>
<span><span class="va">compare_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span><span class="va">compare_fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summarize estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">compare_est</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- PAPE ------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.6           1.2 causal_forest       1.3     0.2</span></span>
<span><span class="co">#&gt; 2      0.0           0.0    user_model       NaN     NaN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- PAPEp -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     2.60           1.2 causal_forest      2.14   0.032</span></span>
<span><span class="co">#&gt; 2     0.97           1.2    user_model      0.79   0.427</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- PAPDp -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation                  algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.6           1.7 causal_forest x user_model      0.95    0.34</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- AUPEC -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     2.35          0.98 causal_forest      2.40   0.016</span></span>
<span><span class="co">#&gt; 2    -0.57          0.88    user_model     -0.65   0.515</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- GATE ------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;    estimate std.deviation     algorithm group statistic p.value upper lower</span></span>
<span><span class="co">#&gt; 1        35           109 causal_forest     1      0.33 7.5e-01  -143   214</span></span>
<span><span class="co">#&gt; 2       145           109 causal_forest     2      1.34 1.8e-01   -34   324</span></span>
<span><span class="co">#&gt; 3        56           109 causal_forest     3      0.52 6.1e-01  -123   235</span></span>
<span><span class="co">#&gt; 4      -146           108 causal_forest     4     -1.35 1.8e-01  -322    31</span></span>
<span><span class="co">#&gt; 5       -72           107 causal_forest     5     -0.67 5.0e-01  -247   104</span></span>
<span><span class="co">#&gt; 6      -249           104    user_model     1     -2.39 1.7e-02  -421   -77</span></span>
<span><span class="co">#&gt; 7      -455           104    user_model     2     -4.39 1.1e-05  -625  -284</span></span>
<span><span class="co">#&gt; 8      -303           105    user_model     3     -2.88 4.0e-03  -477  -130</span></span>
<span><span class="co">#&gt; 9       316           110    user_model     4      2.88 4.0e-03   135   496</span></span>
<span><span class="co">#&gt; 10      711           109    user_model     5      6.51 7.4e-11   531   890</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare_est</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/README-compare_itr_model_summary-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Lingzhi Li, Kosuke Imai, Jialu Li, Xiaolong Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
